<!DOCTYPE html>
<html>
<head>
    <title>Simple Bulk Delete</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .btn { background-color: #dc3545; color: white; border: none; padding: 10px 15px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Simple Bulk Delete Form</h1>
    <p>Use this form to delete multiple items at once.</p>
    
    <form id="bulk-delete-form" action="/barang/bulk-destroy" method="POST">
        <!-- CSRF Token - will be added via JavaScript -->
        <input type="hidden" id="csrf-token" name="_token" value="">
        
        <p>Select items to delete:</p>
        <div id="checkboxes">
            <!-- Checkboxes will be added dynamically -->
            Loading items...
        </div>
        
        <br>
        <button type="submit" class="btn" onclick="return confirmDelete()">Delete Selected Items</button>
    </form>
    
    <script>
        // Get CSRF token from meta tag (Laravel adds this to all pages)
        function getCsrfToken() {
            return fetch('/test-login')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const metaTag = doc.querySelector('meta[name="csrf-token"]');
                    return metaTag ? metaTag.getAttribute('content') : '';
                });
        }
        
        // Load items from the server
        function loadItems() {
            fetch('/test-bulk-delete-form')
                .then(response => response.text())
                .then(html => {
                    const parser = new DOMParser();
                    const doc = parser.parseFromString(html, 'text/html');
                    const checkboxes = doc.querySelectorAll('.item-checkbox');
                    const container = document.getElementById('checkboxes');
                    
                    container.innerHTML = '';
                    
                    if (checkboxes.length === 0) {
                        container.innerHTML = '<p>No items found</p>';
                        return;
                    }
                    
                    // Get table rows from the source page
                    const rows = doc.querySelectorAll('tbody tr');
                    rows.forEach(row => {
                        const checkbox = row.querySelector('input[type="checkbox"]');
                        if (checkbox) {
                            const id = checkbox.value;
                            const name = row.querySelectorAll('td')[3].textContent.trim();
                            const code = row.querySelectorAll('td')[2].textContent.trim();
                            
                            const div = document.createElement('div');
                            div.innerHTML = `
                                <label>
                                    <input type="checkbox" name="barang_ids[]" value="${id}">
                                    ${code} - ${name}
                                </label>
                            `;
                            container.appendChild(div);
                        }
                    });
                });
        }
        
        // Confirm delete
        function confirmDelete() {
            const checked = document.querySelectorAll('input[name="barang_ids[]"]:checked');
            if (checked.length === 0) {
                alert('Please select at least one item to delete');
                return false;
            }
            
            return confirm(`Are you sure you want to delete ${checked.length} items?`);
        }
        
        // Initialize
        document.addEventListener('DOMContentLoaded', function() {
            // Get CSRF token
            getCsrfToken().then(token => {
                document.getElementById('csrf-token').value = token;
            });
            
            // Load items
            loadItems();
            
            // Handle form submission
            document.getElementById('bulk-delete-form').addEventListener('submit', function(e) {
                if (!confirmDelete()) {
                    e.preventDefault();
                }
            });
        });
    </script>
</body>
</html> 